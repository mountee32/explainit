<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questions Report</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
        .import-btn-container {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Questions Report</h1>
        <div class="import-btn-container">
            <label class="btn btn-primary" for="importFile">
                Import
                <input type="file" id="importFile" accept=".json" style="display: none;" />
            </label>
        </div>
        <!-- Rest of the HTML code -->
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var url = "https://explainit.app/api/read.php";
        var apiKey = '55556666';

        // Add the following function to handle file input change event
        function importQuestionsFromFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const jsonData = JSON.parse(e.target.result);
                    let successCount = 0;
                    let failureCount = 0;
                    let failedIds = [];

                    const requests = jsonData.map((questionData) => {
                        return new Promise((resolve, reject) => {
                            $.ajax({
                                url: 'https://explainit.app/api/create.php',
                                type: 'POST',
                                headers: {
                                    'Authorization': 'Bearer ' + apiKey
                                },
                                contentType: 'application/json',
                                data: JSON.stringify(questionData),
                                success: function (response) {
                                    console.log(response);
                                    successCount++;
                                    resolve();
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                    console.log(jqXHR);
                                    console.log(textStatus);
                                    console.log(errorThrown);
                                    failureCount++;
                                    failedIds.push(questionData.ID);
                                    resolve();
                                }
                            });
                        });
                    });

                    Promise.all(requests).then(() => {
                        const message = `Total records read: ${jsonData.length}\n` +
                            `Successfully created: ${successCount}\n` +
                            `Failed to create: ${failureCount}\n` +
                            (failedIds.length > 0 ? `Failed IDs: ${failedIds.join(', ')}` : '');
                        alert(message);
                    });
                };
                reader.readAsText(file);
            }
        }

        // Add the event listener to the file input
        document.getElementById('importFile').addEventListener('change', importQuestionsFromFile);

        // Rest of the JavaScript code for loading questions
        $.ajax({
            url: url,
            type: "GET",
            headers: {
                "Authorization": "Bearer " + apiKey
            },
            // Rest of the code for loading questions
        });
    </script>

</body>

</html>
